# VirtualBox网络环境搭建

vbox通过网络环境的配置能虚拟出现实中各种复杂的网络环境，方便我们做攻击和渗透测试实验。

vbox中一台虚拟机有四个网卡接口，常用的也有四种网卡配置：

|                        | 优点                                           | 缺点                                 |
| ---------------------- | ---------------------------------------------- | ------------------------------------ |
| NAT地址转化            | 不需要做任何配置就可以方便快捷上网             | 主机不能连通虚拟机，需要端口转发     |
| 桥接网络               | 最接近真实网络环境                             | 共用一张真实网卡，速度和可定制化受限 |
| 内部网络               | 沙盒测试，模拟封闭网络                         | 场景单一，只能虚拟机之间互通         |
| 仅主机模式（hostonly） | 主机可以和任何虚拟机互通，虚拟机之间也可以互通 | 虚拟机不能上网                       |

## 网卡配置

- Ubuntu18.04

```shell
# 下载配置模板
git clone https://github.com/ccnoob/network-config
# 进入项目文件
cd network-config
# 其中50-cloud-init.yaml就是网卡配置文件，修改或添加相应设置
vi 50-cloud-init.yaml
# 覆盖已有配置
cp -rvf  50-cloud-init.yaml /etc/netplan/50-cloud-init.yaml
# 应用配置
netplan apply
```

- Kali以及Debian系列包括Ubuntu16.04

```shell
# 下载配置模板
git clone https://github.com/ccnoob/network-config
# 进入项目文件
cd network-config
# 其中interfaces就是网卡配置文件，修改或添加相应设置
vi interfaces
# 覆盖已有配置
cp -rvf interfaces /etc/network/interfaces
# 重启网络配置生效（或重启）
systemctl restart networking
```

## 常见网络场景

### 只需要虚拟机可以上网

采用NAT地址转换，无需任何配置

---

### 虚拟机可以上网,主机要能远程登录

采用NAT地址转化，设置端口转发

---

### 不同电脑之间，机器和虚拟机需要互联

采用桥接模式，无需任何设置

---

### 仅需要模拟一个内部局域网，虚拟机能通信，主机不需要通信

采用内部网络模式，虚拟机需要设置ip地址

---

### 不需要上网，主机和虚拟机，虚拟机与虚拟机之间都能互通

采用仅主机模式（hostonly），设置ip地址以及dhcp规则

---

### 又能上网，主机与虚拟机能互通，虚拟机之间也能互通

采用多网卡配置

- 网卡1：NAT地址转化
- 网卡2：仅主机模式（hostonly）

---

### 能上网，不同电脑之间的主机和虚拟机都能互通

采用多网卡配置

- 网卡1：NAT地址转化
- 网卡2：桥接模式
- 网卡3：仅主机模式

### （终极模式）能上网，不同电脑之间的主机和虚拟机都能互通，且有自己的局域网

---

采用多网卡配置

- 网卡1：NAT地址转化
- 网卡2：桥接模式
- 网卡3：内部网络
- 网卡4：仅主机模式（hostonly）
